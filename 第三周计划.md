# 第 3 周学习计划（可直接复制保存）

## 周目标（总 20h）

- 将第 2 周拆分的服务部署到本地 Kubernetes（minikube 或 k3d）。
- 为服务添加 Kubernetes 清单（Deployment、Service、ConfigMap、Secret、Ingress/IngressRoute）、就绪/存活探针与资源限制。
- 快速接入可观测性：Prometheus + Grafana（metrics）、Loki 或 Elasticsearch + Kibana（日志）。
- 产出：k8s manifests、部署说明（README）、监控 dashboard 截图与周复盘。

---

## 时间分配

- 工作日（周一～周五）：每天 2h（共 10h）
- 周末（周六～周日）：每天 5h（共 10h）

---

## 每日计划

### 第 1 天（周一，2h） — 环境准备与方案确认

- 任务：
  - 安装并验证本地 k8s：选择 minikube 或 k3d（Windows 上推荐 k3d + Docker Desktop 或 minikube）。
  - 验证 kubectl 可用：kubectl version、kubectl cluster-info。
- 验证命令（PowerShell）：

```bash
# minikube
minikube start --driver=docker
kubectl cluster-info

# 或 k3d
k3d cluster create dev-cluster
kubectl cluster-info
```

- 交付：k8s 集群运行截图或命令输出。

---

### 第 2 天（周二，2h） — 制作 Kubernetes manifests（基础）

- 任务：
  - 为 user-service 与 order-service 编写 Deployment + Service + ConfigMap + Secret（确保镜像可拉取或使用本地镜像加载策略）。
  - 添加资源请求/限制（requests/limits）与 liveness/readiness probe。
- 交付：两个服务的 YAML 文件（deployments/services）。

示例探针片段：

```yaml
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 5
resources:
  requests:
    cpu: "100m"
    memory: "128Mi"
  limits:
    cpu: "500m"
    memory: "512Mi"
```

---

### 第 3 天（周三，2h） — 部署并验证服务

- 任务：
  - 将 manifests 应用到集群，检查 Pod/Service 状态。
  - 若使用本地镜像：将镜像加载到集群（minikube image load / k3d image import）。
- 验证命令：

```bash
kubectl apply -f k8s/
kubectl get pods -n default
kubectl logs deployment/user-service
kubectl port-forward svc/user-service 8081:8080
```

- 交付：端到端请求能通过 port-forward 或 Ingress 访问的证明（curl 输出或日志片段）。

---

### 第 4 天（周四，2h） — 接入 Prometheus + Grafana（快速安装）

- 任务：
  - 使用 Helm 或 manifests 安装 Prometheus + Grafana（建议使用 kube-prometheus-stack 或简单的 prometheus-operator chart）。
  - 配置服务 metrics 暴露（Spring Actuator / Micrometer 指标）。
- 简要 Helm 示例：

```bash
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
helm install prometheus prometheus-community/kube-prometheus-stack
```

- 交付：Prometheus 抓取到服务指标 + Grafana 能看到一个简单面板截图。

---

### 第 5 天（周五，2h） — 日志收集（Loki 或 ELK）与集中查看

- 任务：
  - 快速部署 Loki + Grafana/Loki Stack 或 Elasticsearch + Kibana（可使用 Helm chart）。
  - 配置 Pod 日志采集（Fluent Bit/Fluentd）。
- 验证命令/示例：

```bash
# 安装 loki + promtail（示例）
helm repo add grafana https://grafana.github.io/helm-charts
helm install loki grafana/loki-stack
```

- 交付：能在 Grafana/Kibana 中查看服务日志的证明（截图或查询结果）。

---

### 第 6 天（周六，5h） — CI/CD 与 k8s 部署流水线（入门）

- 任务：
  - 在 GitHub Actions 中添加一个 workflow：构建镜像、推送到 Registry（GHCR 或 Docker Hub）、在 k8s 集群触发部署（kubectl apply 或 使用 kustomize/helm）。
  - 若集群在本地，演示通过 workflow 构建镜像并手工部署；若使用远端测试集群，可配置 secrets 完成自动部署。
- 核心步骤：
  - Build -> Push -> kubectl apply（或 helm upgrade --install）
- 交付：CI workflow 文件 + 一次成功的镜像构建记录（或部署日志）。

---

### 第 7 天（周日，5h） — 性能与监控小结，周复盘

- 任务：
  - 用简单负载（curl 并发脚本 或 k6）对服务做轻量压测，查看指标（CPU/内存/请求率/错误率）。
  - 撰写监控配置与问题清单（如指标缺失、日志丢失、探针不稳定等）。
- 验证命令（示例 k6）：

```bash
k6 run --vus 10 --duration 30s script.js
```

- 交付：压测结果截图/指标变化图 + 周复盘文档（技术债/下周计划）。

---

## 周验收标准

- 两个服务成功部署在 k8s（Pods 就绪，Service 可访问）。
- Prometheus 能抓取到至少 3 个自定义指标并在 Grafana 展示。
- 日志集中方案能在 UI 中查询到服务日志。
- 有基础 CI/CD 流程示例（构建镜像并部署到 k8s 的步骤记录）。
- 提交 tech-note.md 总结本周经验与遇到的问题。

---

## 关键资源

- minikube / k3d 官方文档
- Helm 与 kube-prometheus-stack chart 示例
- Spring Boot Actuator + Micrometer 指标文档
- Promtail / Fluent Bit 日志采集文档
- GitHub Actions 部署到 Kubernetes 示例

---

## 简短下一步建议

- 若本周完成：第 4 周优先补强分布式设计（消息/事务/限流）与系统设计练习。

````# 第3周学习计划（可直接复制保存）

## 周目标（总 20h）
- 将第2周拆分的服务部署到本地 Kubernetes（minikube 或 k3d）。
- 为服务添加 Kubernetes 清单（Deployment、Service、ConfigMap、Secret、Ingress/IngressRoute）、就绪/存活探针与资源限制。
- 快速接入可观测性：Prometheus + Grafana（metrics）、Loki 或 Elasticsearch + Kibana（日志）。
- 产出：k8s manifests、部署说明（README）、监控 dashboard 截图与周复盘。

---

## 时间分配
- 工作日（周一～周五）：每天 2h（共 10h）
- 周末（周六～周日）：每天 5h（共 10h）

---

## 每日计划

### 第1天（周一，2h） — 环境准备与方案确认
- 任务：
  - 安装并验证本地 k8s：选择 minikube 或 k3d（Windows 上推荐 k3d + Docker Desktop 或 minikube）。
  - 验证 kubectl 可用：kubectl version、kubectl cluster-info。
- 验证命令（PowerShell）：
```bash
# minikube
minikube start --driver=docker
kubectl cluster-info

# 或 k3d
k3d cluster create dev-cluster
kubectl cluster-info
````

- 交付：k8s 集群运行截图或命令输出。

---

### 第 2 天（周二，2h） — 制作 Kubernetes manifests（基础）

- 任务：
  - 为 user-service 与 order-service 编写 Deployment + Service + ConfigMap + Secret（确保镜像可拉取或使用本地镜像加载策略）。
  - 添加资源请求/限制（requests/limits）与 liveness/readiness probe。
- 交付：两个服务的 YAML 文件（deployments/services）。

示例探针片段：

```yaml
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 5
resources:
  requests:
    cpu: "100m"
    memory: "128Mi"
  limits:
    cpu: "500m"
    memory: "512Mi"
```

---

### 第 3 天（周三，2h） — 部署并验证服务

- 任务：
  - 将 manifests 应用到集群，检查 Pod/Service 状态。
  - 若使用本地镜像：将镜像加载到集群（minikube image load / k3d image import）。
- 验证命令：

```bash
kubectl apply -f k8s/
kubectl get pods -n default
kubectl logs deployment/user-service
kubectl port-forward svc/user-service 8081:8080
```

- 交付：端到端请求能通过 port-forward 或 Ingress 访问的证明（curl 输出或日志片段）。

---

### 第 4 天（周四，2h） — 接入 Prometheus + Grafana（快速安装）

- 任务：
  - 使用 Helm 或 manifests 安装 Prometheus + Grafana（建议使用 kube-prometheus-stack 或简单的 prometheus-operator chart）。
  - 配置服务 metrics 暴露（Spring Actuator / Micrometer 指标）。
- 简要 Helm 示例：

```bash
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
helm install prometheus prometheus-community/kube-prometheus-stack
```

- 交付：Prometheus 抓取到服务指标 + Grafana 能看到一个简单面板截图。

---

### 第 5 天（周五，2h） — 日志收集（Loki 或 ELK）与集中查看

- 任务：
  - 快速部署 Loki + Grafana/Loki Stack 或 Elasticsearch + Kibana（可使用 Helm chart）。
  - 配置 Pod 日志采集（Fluent Bit/Fluentd）。
- 验证命令/示例：

```bash
# 安装 loki + promtail（示例）
helm repo add grafana https://grafana.github.io/helm-charts
helm install loki grafana/loki-stack
```

- 交付：能在 Grafana/Kibana 中查看服务日志的证明（截图或查询结果）。

---

### 第 6 天（周六，5h） — CI/CD 与 k8s 部署流水线（入门）

- 任务：
  - 在 GitHub Actions 中添加一个 workflow：构建镜像、推送到 Registry（GHCR 或 Docker Hub）、在 k8s 集群触发部署（kubectl apply 或 使用 kustomize/helm）。
  - 若集群在本地，演示通过 workflow 构建镜像并手工部署；若使用远端测试集群，可配置 secrets 完成自动部署。
- 核心步骤：
  - Build -> Push -> kubectl apply（或 helm upgrade --install）
- 交付：CI workflow 文件 + 一次成功的镜像构建记录（或部署日志）。

---

### 第 7 天（周日，5h） — 性能与监控小结，周复盘

- 任务：
  - 用简单负载（curl 并发脚本 或 k6）对服务做轻量压测，查看指标（CPU/内存/请求率/错误率）。
  - 撰写监控配置与问题清单（如指标缺失、日志丢失、探针不稳定等）。
- 验证命令（示例 k6）：

```bash
k6 run --vus 10 --duration 30s script.js
```

- 交付：压测结果截图/指标变化图 + 周复盘文档（技术债/下周计划）。

---

## 周验收标准

- 两个服务成功部署在 k8s（Pods 就绪，Service 可访问）。
- Prometheus 能抓取到至少 3 个自定义指标并在 Grafana 展示。
- 日志集中方案能在 UI 中查询到服务日志。
- 有基础 CI/CD 流程示例（构建镜像并部署到 k8s 的步骤记录）。
- 提交 tech-note.md 总结本周经验与遇到的问题。

---

## 关键资源

- minikube / k3d 官方文档
- Helm 与 kube-prometheus-stack chart 示例
- Spring Boot Actuator + Micrometer 指标文档
- Promtail / Fluent Bit 日志采集文档
- GitHub Actions 部署到 Kubernetes 示例

---

## 简短下一步建议

- 若本周完成：第 4 周优先补强分布式设计（消息/事务/限流）与系统设计练习。
